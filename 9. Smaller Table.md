# Smaller Table
---
> Paging은 어떤 점이 문제였는가?  
> Linear한 1차원 Table을 사용하기 때문에, 안쓰는 공간들도 모두 Process당 하나씩 들고 있어야하는 공간 낭비가 발생했었다.  
> 그럼 어떻게 좀 더 작은 Table을 들고 다닐 수 있을까?  

## Hybrid Approach : Paging & Segmentation
> Paging과 Segmentation을 한번 결합해 보는 것은 어떨까?  

- 각 Process당 하나씩 Table을 통째로 갖는 것이 아니다.
  - 먼저 Logic 단위의 Segmentation을 자른 뒤에, 다시 동일한 크기의 Page로 자른다. 각 Segments들마다 각각 자신만의 Page Table을 가지고 있도록 한다.
  - 이러면 사용하지 않는 공간에 대한 Table은 갖고 있지 않으므로, 공간낭비가 방지된다.  
  ![image](https://user-images.githubusercontent.com/71700079/164000517-b008f215-851f-4cba-8840-405b3201c135.png)  
  - 원래 Segmentation 기법에서는, 상위 2bit가 Physical Address에 바로 접근하도록 했지만
    - 여기서는 Page Table의 시작 주소를 찾는데에 이용된다.

### Issues
> 하지만 이 방법에도 문제는 있다.  

- Sparsely used-heap 문제가 발생한다.
  - Stack이나 Code공간과는 다르게, Heap 공간은 무작위로 메모리 위치를 할당한다.
  - 따라서 Heap 공간에는 External Fragmentation이 다시 발생할 수 있다.

## Multi Level Page Table
> 많은 시행착오를 거치고,  
> 현대에서 사용 중인 Page Table 할당 방식이다.  

- Page Table을 Page와 같은 크기로 잘라버리는 것이다!
  - 같은 크기로 다 잘라버린 뒤 Paging 기법과 같이 Memory에 뿌린다.
  - 이 때, Invalid한 Page만 있는 Table 조각은 저장하지 않는다. (공간 낭비가 여기서 막아진다.)
  - Page Directory라는 Table의 상위 Table을 만들어서 거기에 각 Page Table의 위치를 저장한다.
  - 아래는 Linear Table과 Multi-Level Table을 비교한다.  
  ![image](https://user-images.githubusercontent.com/71700079/164002479-7ad3b474-8d16-4e64-adde-a18ba35757aa.png)    
    - PDE(Page Directory Entry)는 Valid Bit를 갖는다. (사용중인지 아닌지)
    - PFN(Page Frame Number)를 들고 있어야 한다.

### Pros & Cons
- Pros
  - 실제 사용중인 Address Space 영역에 대해서만 실제 할당을 해서 사용하므로, 공간 낭비가 적다.
- Cons
  - 매우 복잡하다.
  - Time과 Space는 Trade-off 관계에 있어서 공간 낭비가 줄었지만, 시간이 좀 더 오래 걸린다.  
    Why?) Directory에 한 번 접근하고, Page Table에 한 번더 접근해야 하기 때문이다.

### Multi-Level Page Table : Indirection
> 기존의 Page Table은 위치가 연속된 공간이어야 했다.(Linear)  
> 하지만 MLPT는 간접 참조를 하기 때문에, 굳이 연속된 공간으로 저장될 필요가 없다!  
